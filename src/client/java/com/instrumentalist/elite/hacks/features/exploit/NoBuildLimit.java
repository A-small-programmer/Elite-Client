package com.instrumentalist.elite.hacks.features.exploit;

import com.instrumentalist.elite.events.features.SendPacketEvent;
import com.instrumentalist.elite.hacks.Module;
import com.instrumentalist.elite.hacks.ModuleCategory;
import com.instrumentalist.elite.hacks.ModuleManager;
import com.instrumentalist.elite.utils.IMinecraft;
import com.instrumentalist.elite.utils.packet.PacketUtil;
import net.minecraft.network.packet.Packet;
import net.minecraft.network.packet.c2s.play.PlayerInteractBlockC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerInteractItemC2SPacket;
import net.minecraft.util.hit.BlockHitResult;
import net.minecraft.util.math.Direction;
import org.lwjgl.glfw.GLFW;

public class NoBuildLimit extends Module {

    public NoBuildLimit() {
        super("No Build Limit", ModuleCategory.Exploit, GLFW.GLFW_KEY_UNKNOWN, false, true);
    }

    @Override
    public void onDisable() {
    }

    @Override
    public void onEnable() {
    }

    @Override
    public void onSendPacket(SendPacketEvent event) {
        if (IMinecraft.mc.player == null || IMinecraft.mc.world == null) return;

        Packet<?> packet = event.packet;

        if (packet instanceof PlayerInteractBlockC2SPacket && ((PlayerInteractBlockC2SPacket) packet).getBlockHitResult().getPos().y >= IMinecraft.mc.world.getHeight() && ((PlayerInteractBlockC2SPacket) packet).getBlockHitResult().getSide() == Direction.UP) {
            event.cancel();
            BlockHitResult hitResult = new BlockHitResult(((PlayerInteractBlockC2SPacket) packet).getBlockHitResult().getPos(), Direction.DOWN, ((PlayerInteractBlockC2SPacket) packet).getBlockHitResult().getBlockPos(), ((PlayerInteractBlockC2SPacket) packet).getBlockHitResult().isInsideBlock());
            PacketUtil.sendPacketAsSilent(new PlayerInteractBlockC2SPacket(((PlayerInteractBlockC2SPacket) packet).getHand(), hitResult, ((PlayerInteractBlockC2SPacket) packet).getSequence()));
        }
    }
}
